{"version":3,"file":"okta-react.cjs.js","sources":["../../src/OktaContext.ts","../../src/OktaError.tsx","../../src/Security.tsx","../../src/withOktaAuth.tsx","../../src/LoginCallback.tsx","../../src/RouteGuard.tsx"],"sourcesContent":["/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport * as React from 'react';\nimport { AuthState, OktaAuth } from '@okta/okta-auth-js';\n\nexport type OnAuthRequiredFunction = (oktaAuth: OktaAuth) => Promise<void> | void;\nexport type OnAuthResumeFunction = () => void;\n\nexport type RestoreOriginalUriFunction = (oktaAuth: OktaAuth, originalUri: string) => Promise<void> | void;\n\nexport interface IOktaContext {\n    oktaAuth: OktaAuth;\n    authState: AuthState;\n    _onAuthRequired: OnAuthRequiredFunction;\n}\n\nconst OktaContext = React.createContext<IOktaContext | null>(null);\n\nexport const useOktaAuth = (): IOktaContext => React.useContext(OktaContext);\n\nexport default OktaContext;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\n\nconst OktaError: React.FC<{ error: Error }> = ({ error }) => { \n  if(error.name && error.message) { \n    return <p>{error.name}: {error.message}</p>;\n  }\n  return <p>Error: {error.toString()}</p>;\n};\n\nexport default OktaError;\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { AuthSdkError, OktaAuth } from '@okta/okta-auth-js';\nimport OktaContext, { OnAuthRequiredFunction, RestoreOriginalUriFunction } from './OktaContext';\nimport OktaError from './OktaError';\n\nconst Security: React.FC<{\n  oktaAuth: OktaAuth,\n  restoreOriginalUri: RestoreOriginalUriFunction, \n  onAuthRequired?: OnAuthRequiredFunction,\n  children?: React.ReactNode\n} & React.HTMLAttributes<HTMLDivElement>> = ({ \n  oktaAuth,\n  restoreOriginalUri, \n  onAuthRequired, \n  children\n}) => { \n  const [authState, setAuthState] = React.useState(() => {\n    if (!oktaAuth) {\n      return { \n        isPending: true,\n        isAuthenticated: false,\n        idToken: null,\n        accessToken: null,\n      };\n    }\n    return oktaAuth.authStateManager.getAuthState();\n  });\n\n  React.useEffect(() => {\n    if (!oktaAuth || !restoreOriginalUri) {\n      return;\n    }\n\n    // Add default restoreOriginalUri callback\n    if (oktaAuth.options.restoreOriginalUri && restoreOriginalUri) {\n      console.warn('Two custom restoreOriginalUri callbacks are detected. The one from the OktaAuth configuration will be overridden by the provided restoreOriginalUri prop from the Security component.');\n    }\n    oktaAuth.options.restoreOriginalUri = async (oktaAuth: unknown, originalUri: string) => {\n      restoreOriginalUri(oktaAuth as OktaAuth, originalUri);\n    };\n\n    // Add okta-react userAgent\n    oktaAuth.userAgent = `${process.env.PACKAGE_NAME}/${process.env.PACKAGE_VERSION} ${oktaAuth.userAgent}`;\n\n    // Update Security provider with latest authState\n    oktaAuth.authStateManager.subscribe((authState) => {\n      setAuthState(authState);\n    });\n\n    // Trigger an initial change event to make sure authState is latest\n    if (!oktaAuth.isLoginRedirect()) {\n      oktaAuth.authStateManager.updateAuthState();\n    }\n\n    return () => oktaAuth.authStateManager.unsubscribe();\n  }, [oktaAuth, restoreOriginalUri]);\n\n  if (!oktaAuth) {\n    const err = new AuthSdkError('No oktaAuth instance passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  if (!restoreOriginalUri) {\n    const err = new AuthSdkError('No restoreOriginalUri callback passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  return (\n    <OktaContext.Provider value={{ \n      oktaAuth, \n      authState, \n      _onAuthRequired: onAuthRequired\n    }}>\n      {children}\n    </OktaContext.Provider>\n  );\n};\n\nexport default Security;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, IOktaContext } from './OktaContext';\n\nconst withOktaAuth = <P extends IOktaContext>(\n  ComponentToWrap: React.ComponentType<P>\n): React.FC<Omit<P, keyof IOktaContext>> => { \n  const WrappedComponent = (props) => { \n    const oktaAuthProps = useOktaAuth();\n    return <ComponentToWrap {...oktaAuthProps as IOktaContext } {...props as P} />;\n  };\n  WrappedComponent.displayName = 'withOktaAuth_' + (ComponentToWrap.displayName || ComponentToWrap.name);\n  return WrappedComponent;\n};\n\nexport default withOktaAuth;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, OnAuthResumeFunction } from './OktaContext';\nimport OktaError from './OktaError';\n\nconst LoginCallback: React.FC<{ \n  errorComponent?: React.ComponentType<{ error: Error }>,\n  onAuthResume?: OnAuthResumeFunction,\n}> = ({ errorComponent, onAuthResume }) => { \n  const { oktaAuth, authState } = useOktaAuth();\n  const authStateReady = !authState.isPending;\n  const ErrorReporter = errorComponent || OktaError;\n\n  React.useEffect(() => {\n\n    if (onAuthResume && oktaAuth.isInteractionRequired?.() ) {\n      onAuthResume();\n      return;\n    }\n    oktaAuth.handleLoginRedirect()\n    .catch( err => { \n      console.log(err); //TODO: handle these errors OKTA-361608\n    });  \n\n  }, [oktaAuth]);\n\n  if(authStateReady && authState.error) { \n    return <ErrorReporter error={authState.error}/>;\n  }\n\n  return null;\n};\n\nexport default LoginCallback;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { Navigate, useLocation } from 'react-router-dom';\nimport { useOktaAuth } from './OktaContext';\n\nconst RouteGuard: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({ children }) => {\n  const { oktaAuth, authState, _onAuthRequired } = useOktaAuth();\n  const location = useLocation();\n  const pendingLogin = React.useRef(false);\n  const [requestedLocation, setRequestedLocation] = React.useState(null);\n\n  React.useEffect(() => {\n    const handleLogin = async () => {\n      if (pendingLogin.current) {\n        return;\n      }\n\n      pendingLogin.current = true;\n      oktaAuth.setOriginalUri();\n\n      await oktaAuth.signInWithRedirect();\n    };\n\n    if (authState.isAuthenticated) {\n      pendingLogin.current = false;\n      return;\n    }\n\n    // Start login if app has decided it is not logged in and there is no pending signin\n    if (!authState.isAuthenticated && !authState.isPending) {\n      handleLogin();\n    }\n  }, [authState.isPending, authState.isAuthenticated, oktaAuth, _onAuthRequired]);\n\n  if (!authState.isAuthenticated) {\n    if (location.pathname !== requestedLocation) {\n      setRequestedLocation(location.pathname);\n    }\n    return null;\n  }\n\n  // This is done so that in case the route changes by any chance through other\n  // means between the moment of request and the render we navigate to the initially\n  // requested route.\n  if (requestedLocation && location.pathname !== requestedLocation) {\n    setRequestedLocation(null);\n    return <Navigate to={requestedLocation} />;\n  }\n\n  return <>{children}</>;\n};\n\nexport default RouteGuard;\n"],"names":["OktaContext","React","useOktaAuth","OktaError","error","name","message","toString","Security","oktaAuth","restoreOriginalUri","onAuthRequired","children","isPending","isAuthenticated","idToken","accessToken","authStateManager","getAuthState","authState","setAuthState","options","console","warn","originalUri","userAgent","subscribe","isLoginRedirect","updateAuthState","unsubscribe","err","AuthSdkError","Provider","value","_onAuthRequired","withOktaAuth","ComponentToWrap","WrappedComponent","props","oktaAuthProps","displayName","LoginCallback","errorComponent","onAuthResume","authStateReady","ErrorReporter","isInteractionRequired","handleLoginRedirect","log","RouteGuard","location","useLocation","pendingLogin","requestedLocation","setRequestedLocation","handleLogin","current","setOriginalUri","signInWithRedirect","pathname","Navigate","to"],"mappings":"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"}